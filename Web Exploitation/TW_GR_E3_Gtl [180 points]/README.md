# TW_GR_E3_Gtl - 180 Points

Many think the third entry in the Toaster Wars: Going Rogue series didn't live up to Explorers due to its simplified gameplay, but I liked the new plot and ensemble cast better. Anyway, [this one](http://shell2017.picoctf.com:29668/) also has a flag that I can't figure out how to get...

**Hint:** Clearly, you can't get to the flag. But perhaps you don't need to go over to it at all?

## Writeup

In this version of Toaster Wars, the last floor separates you and the flag by an impenetrable wall. This means we must find a way to interact with items without actually touching them. Looking through the game's code, we get our first hint as to how to solve this problem in the `/server/config.js` file. Unlike in the three other versions of the game, the flag item has an `id` of 12 (as opposed to 100). Let's look back to the main game file to see how we can exploit this. Back in `/server/game.js`, we can see that the game determines how and when the player picks up an item using the following block of code:

```JavaScript
// item check
if(entity.items.length < entity.stats.maxItems){
	var itId = -1;
	var name = "";
	for(var i = 0; i < state.items.length; i++){
		if(state.items[i].location.r == entity.location.r && state.items[i].location.c == entity.location.c){
			itId = state.items[i].id;
			msg.outcome.push({
				type: "item/get",
				id: state.items[i].id,
				item: state.items[i].name
			});
			break;
		}
	}
}

entity.items = entity.items.concat(state.items.filter(function(it){ return it.id == itId; }));
state.items = state.items.filter(function(it){ return it.id != itId; });
```

The game checks through a list of items on the current floor and checks if the player is touching any of them. If the answer is yes, it saves the id of that item and adds any item with that id to the player's collection. Looking at the `generateFloor` function in `/server/generator.js`, we can see that items are assigned their id based on the order it's generated on its floor: `item.id = items.length`. This means that if we can find the 12th item generated on a floor, bring it to the last floor, drop it, and pick it up again, we should theoretically pick up not only that item but the flag as well. This may take several tries to accomplish, as the number of items generated on each floor is often much less than 12, but the following pieces of code helped greatly in speeding up the proccess:

```JavaScript
javascript:(function()%7BMOVE_TIME%20%3D%201%3BHURT_TIME%20%3D%201%3BINPUT_TIME%20%3D%201%3BWARP_TIME%20%3D%201%7D)()
```
When run as a bookmarklet, this short script dramatically increases animation speed by decreasing the wait time between actions.
<br><br>
```JavaScript
console.table(state.items);
```
Since the game state is also saved on the client side, running this line of JavaScript in Chrome's developer console displays a nice table revealing the id of every item currently on the screen.
