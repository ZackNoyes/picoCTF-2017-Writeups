M = 93556643250795678718734474880013829509320385402690660619699653921022012489089
A = 66001598144012865876674115570268990806314506711104521036747533612798434904785

b = 400000000000000000000000000000

P = (56027910981442853390816693056740903416379421186644480759538594137486160388926, 65533262933617146434438829354623658858649726233622196512439589744498050226926)
nP = (79745356646949069441279781387743208137742538544495675881933883371885177103895, 34529309219406689418881493671300037164559702076524725195399995669560101677178)

B = 25255205054024371783896605039267101837972419055969636393425590261926131199030

F = GF(M)
E = EllipticCurve(F, [A,B])

P = E(P)
nP = E(nP)

base = []
resid = []

scale = 1
curr_ans = 0

for i, j in factor(E.order()):
    k = i ** j
    print(k)
    np = P * (E.order() // k)
    nnp = nP * (E.order() // k)

    bounds = (0, k)
    if k > b / (scale - curr_ans):
        bounds = (curr_ans, curr_ans + b // (scale - curr_ans))

    dlog = bsgs(np, nnp, bounds, operation='+')
    base.append(dlog)
    resid.append(k)
    curr_ans = crt(curr_ans, dlog, scale, k)

    scale *= k
    print(dlog)

print("ans", CRT_list(base, resid))
